# フェーズD 管理機能移行計画

## 1. フェーズのゴール
- フェーズAで棚卸しした優先度「高」の管理者機能（サーバー情報、アカウント追加、管理者権限設定）を Web UI として提供し、MFC 版と機能同等の運用が行える状態にする。
- API・UI・監査ログを一貫したリリースフローで提供できるよう、フェーズCで整備した HTTP プラットフォーム上に継続的配信パイプラインを構築する。
- MFC 版との併用期間に備えたフェイルバック手順と運用教育を整備し、サポート体制を段階的に Web 中心へ移行する。

## 2. リリースマイルストーン
1. **Wave 1（最低限の運用機能リリース）**
   - 対象: サーバー情報表示、アカウント追加、管理者権限設定。
   - 成果物: 新規 REST API（`/api/server`, `/api/accounts`, `/api/admin/roles`）、操作ログ記録、Web UI モジュール。
   - 完了条件: API コントラクトを OpenAPI で公開し、MFC 版と同一ケースでリグレッションテストが通過。
2. **Wave 2（キャラクター/マップ基本操作の移行）**
   - 対象: キャラ基本情報編集、マップ情報編集、マップイベント閲覧。
   - 成果物: 既存 `PacketADMIN_*` 置き換え API、編集フォーム、差分通知機構。
   - 完了条件: 編集操作でサーバー状態が即時反映され、監査ログと API 応答の整合性が確認できる。
3. **Wave 3（運用高度化と併用解消）**
   - 対象: 監査レポートダウンロード、操作履歴検索、MFC 側フェイルバックパッケージ整備。
   - 完了条件: Web UI が運用チームの主要ワークフローを置き換え、MFC 版の利用が月次 5% 未満となる。

## 3. 機能バックログ（優先度順）
| 優先度 | 機能群 | 主なエピック | API/データ依存 | 備考 |
| --- | --- | --- | --- | --- |
| 高 | 運用基盤 | サーバー状態ダッシュボード、アカウント作成、権限管理 | `CMgrData`, `PacketADMIN_PARA2`, `PacketADMIN_ACCOUNT_ADD` | Wave 1 で実装。|
| 中 | キャラクター管理 | 基本属性編集、所持品参照、ステータス履歴 | `InfoCharCli`, `LibInfoSkill`, `LibInfoMotionType` | Wave 2 で段階提供。|
| 中 | マップ管理 | マップ基本情報、イベント一覧、オブジェクト確認 | `InfoMapBase`, `LibInfoMapEvent`, `MgrGrpData` | 大量データのページング要検討。|
| 低 | ビジュアルリソース | エフェクト編集、武器/アイテム詳細、マップパーツ | `LibInfoEfc*`, `LibInfoWeapon`, `LibInfoItem*` | Wave 3 以降で検討。|
| 横断 | 監査/運用 | 操作ログ閲覧、フェイルバック手順、教育資料 | ログストア（ファイル/DB）、運用 Runbook | 各 Wave 完了時に更新。|

## 4. デリバリープロセス
1. **要件トリアージ**: フェーズAレポートの棚卸し表を基に対象 MFC 画面の機能差分を洗い出し、エピック/ストーリーを整理する。
2. **API 設計**: `docs/admin_phase_c_platform.md` のルーティング規約に従って REST API を設計し、OpenAPI を `docs/apis/admin/` 配下に追加する。
3. **実装フロー**
   - サーバー側: `SboSvr/src/Web/Handlers/` に機能別ハンドラを追加し、`ApiRouter` に登録。`CMgrData` へのアクセスラッパーを用意する。
   - クライアント側: `docs/runbooks/local_dev.md` で定義したフロントビルド手順を流用し、Wave ごとにモジュールを分割して配信。
   - 共通: 監査ログ・エラーハンドリングはフェーズCの共通コンポーネントを使用し、追加要件は `docs/admin_phase_c_platform.md` に追記。
4. **検証**: API 契約テスト、E2E テスト（Playwright など）、負荷テスト（10 同時操作）を自動化。結果は `docs/handovers/phase_d/` に収集。
5. **リリース判定**: フィーチャーフラグを用意し、Wave ごとに段階リリース。ローンチ前に運用チームと UAT を実施し、承認を記録。

## 5. 品質保証とテスト戦略
- **API レベル**: Postman/Newman または REST CLI で CRUD・エラーパスを網羅。OpenAPI から自動生成するスモークテストを CI に組み込む。
- **UI レベル**: Playwright/E2E テストで主要フローを自動化。アクセシビリティチェック（axe-core）を導入し、重要フォームのキーボード操作を担保。
- **統合テスト**: MFC 版との比較テスト（同一操作でのサーバー状態差分確認）をスクリプト化し、回帰を検出する。
- **運用テスト**: ログローテーション、フェイルバック、権限エラー発生時のアラート送出を検証。結果は運用 Runbook に追記。

## 6. ドキュメントと引き継ぎ
- Wave ごとに以下を `docs/handovers/phase_d/` に格納する。
  - 機能概要・画面遷移図
  - API 定義書（OpenAPI）
  - テスト結果サマリー（自動テストログ、手動検証チェックリスト）
  - 運用手順書（フェイルバック・トラブルシュート）
- Web UI コンポーネントのスタイルガイドを `docs/ui/` に追加し、再利用可能なコンポーネント群を整理する。
- 教育資料はナレッジベースに登録し、更新履歴を管理（版数・作成者・最終レビュー日を明記）。

## 7. リスクと対策
- **API と既存パケットの整合性が取れない**: `PacketADMIN_*` の解析結果を仕様書化し、差異はアダプタ層で吸収。必要に応じて並行稼働期間を延長する。
- **UI 実装リソース不足**: Wave 1 はデザイン最小化（運用向け UI）で実装し、Wave 2 以降でリファイン。外部ベンダー支援を検討。
- **性能劣化**: 主要 API の SLA を設定し、CI でベンチマークスクリプトを実行。閾値超過時は自動でアラート。
- **運用教育の遅延**: UAT 期間にトレーニングセッションを組み込み、Web UI リリースの 2 週間前に操作マニュアルを確定。

## 8. 次のアクション
1. Wave 1 対象機能の詳細設計ワークショップを開催し、API I/F と画面ワイヤーフレームを確定する。
2. `docs/apis/admin/` 配下に OpenAPI テンプレートを作成し、CI でスキーマ検証を行うワークフローを追加する。
3. `docs/handovers/phase_d/` ディレクトリを作成し、成果物格納ルールを定義する README を準備する。
4. 運用チームとフェイルバック手順のドラフトを共同で作成し、Runbook 更新スケジュールを決定する。

以上の計画に沿って進めることで、フェーズDで求められる管理者機能の Web 移行を段階的かつ確実に実現します。
