# 20240415_Wave1_機能概要書

- 作成者: Dev (YYYY)
- 更新日: 2024-04-15
- レビュワー: PO (XXXX), QA (CCCC)

## 1. 対象範囲
Wave 1 で実装する以下の 3 機能を対象とする。

1. サーバー情報ダッシュボード
2. アカウント追加フォーム
3. 管理者ロール割り当て画面

## 2. 画面構成
### 2.1 サーバー情報ダッシュボード
- コンポーネント: サーバーカード（世界別3枚）、稼働状況バッジ、メトリクスツールチップ。
- データソース: `/api/server`。30秒間隔でポーリングし、変化時のみ再描画。

### 2.2 アカウント追加フォーム
- 入力フィールド: `loginId`, `displayName`, `email`, `password`, `passwordConfirm`, `roles`。
- バリデーション: `password` は 12〜64文字、`loginId` は英数字・記号（-_.@）のみ。
- エラーハンドリング: 409 受信時は既存アカウントの候補を表示し、メールアドレス重複を警告。

### 2.3 管理者ロール割り当て画面
- レイアウト: 左側にアカウント検索（ID/名前）、右側にロールチェックボックスリスト。
- ロール情報は `/api/admin/roles` GET で取得し、PUT 成功時はトースト通知と差分ハイライトを表示。

## 3. 主要ユースケース
| UC | シナリオ | API 呼び出し | 成功条件 |
| --- | --- | --- | --- |
| UC-01 | サーバー状態確認 | GET `/api/server` | ステータス=200、全サーバーのオンライン状況が表示される |
| UC-02 | 新規アカウント登録 | POST `/api/accounts` | 201応答とともにアカウントIDが払い出され、一覧に即時反映 |
| UC-03 | 権限ロール更新 | PUT `/api/admin/roles?accountId={id}` | 204応答、監査ログに変更履歴が記録される |

## 4. 依存関係
- 認証: 既存 SSO セッション Cookie (`SESSID`) を利用。
- バックエンド: `CMgrData` サービス、`AccountService`、`RoleService`。
- フィーチャーフラグ: `web.admin.wave1` が true の場合にメニュー表示。

## 5. 非機能要件
- 応答時間: `/api/server` 500ms 以下、`/api/accounts` 1 秒以内。
- 可用性: Wave 1 期間は 99.5% を確保。フェイルバック手順は Runbook 参照。
- 監査: ロール更新はすべて `admin_audit` テーブルに `accountId`, `modifierId`, `diff`, `comment` を記録。

## 6. UAT 受け入れ条件
1. サーバー情報が既存 MFC 画面と同等の精度で表示されること。
2. アカウント登録で重複検知が正しく動作すること。
3. ロール更新後、再読込しても差分が永続化されていること。
4. 権限不足ユーザーでアクセスすると 403 が返ること。

以上。
