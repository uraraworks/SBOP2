# SboCli 管理者画面 Web 移行計画

## 1. 背景と目的
- 現状: 管理者機能は MFC ダイアログで提供されており、SboCli に組み込まれている。
- 課題: リモート操作の難しさ、UI 更新コストの高さ、Windows ネイティブ UI に依存。
- 目的: サーバー側に簡易 Web サーバー機能を追加し、Web ブラウザから管理者機能にアクセス可能とする。

## 2. 全体方針
1. 現行 MFC 画面と機能を棚卸しし、API 化の優先度を決める。
2. SboSvr（サーバー）に常駐する HTTP サーバー機能を実装し、REST/JSON ベースで管理 API を提供する。
3. 管理 UI は最初はシンプルな HTML/CSS/JavaScript（可能なら既存のフロント資産を流用）で構築し、必要に応じて SPA フレームワーク導入を検討する。
4. セキュリティ（認証・認可・通信保護）とログ監査を最初から設計に組み込む。

## 3. フェーズ別タスク

### フェーズ A: 現状調査と要件定義
- [x] 既存 MFC 管理画面の一覧と機能要件を整理する。（docs/admin_phase_a_report.md を参照）
- [x] 各画面が参照・更新するデータソース（DB、設定ファイル、SboSvr 内部状態）を調査する。（docs/admin_phase_a_report.md を参照）
- [x] 利用頻度、運用上の重要度、依存関係を評価し優先度を決める。（docs/admin_phase_a_report.md を参照）
- [x] Web 管理画面に必要な非機能要件（同時接続数、レスポンス時間、認証方式、利用ブラウザ）を明文化する。（docs/admin_phase_a_report.md を参照）
- [x] 引き継ぎ用の共通ドキュメントフォーマットを定義する（例: Confluence/Wiki ページテンプレート）。（docs/admin_phase_a_report.md を参照）

### フェーズ B: アーキテクチャ設計
- [x] 簡易 Web サーバーの構成を決める（既存ライブラリ採用 vs 独自実装）。詳しくは docs/admin_phase_b_architecture.md を参照。
  - 候補: cpp-httplib などの軽量 C++ HTTP サーバー、もしくは既存の SboSockLib 拡張。
- [x] HTTP サーバーと SboSvr 既存機構の連携方式を決める（スレッドモデル、イベントループ統合、リソース管理）。
- [x] 認証・認可の方式（Basic 認証、トークンベース、IP 制限など）を設計する。
- [x] API 設計方針（URI 形式、HTTP メソッド、JSON スキーマ）を策定し、API ドキュメントのテンプレートを用意する。
- [x] フロントエンドの構成（静的ファイル配信かビルド済みアセットか）と開発体制を決定する。

### フェーズ C: プラットフォーム基盤実装
- [ ] HTTP サーバーの最小実装（ヘルスチェック、静的ファイル配信）を作成する。計画とマイルストーンは docs/admin_phase_c_platform.md を参照し、PoC の詳細は docs/admin_phase_c_http_server_poc.md にまとめ済み。
- [ ] 共通ミドル層として API ハンドラ登録の仕組みを実装する。必要なインターフェースとルーティング戦略は docs/admin_phase_c_platform.md に整理済み。
- [ ] 認証・認可・ログ記録・エラーハンドリングの共通コンポーネントを実装する。リスク対策と担当割り当ては docs/admin_phase_c_platform.md を参照。
- [ ] 開発・テスト環境（ローカル、ステージング）でのデプロイ手順を整備する。Runbook やスクリプト整備タスクを docs/admin_phase_c_platform.md に定義。
- [ ] CI/CD パイプラインにユニットテスト・静的解析・API テストを組み込む（既存パイプラインがなければ設計する）。自動化の対象とチェックリストは docs/admin_phase_c_platform.md に記載。

### フェーズ D: 管理機能の段階的移行
- [ ] 優先度の高い画面から順に、API 化 → Web UI 実装 → 受け入れテストを実施する（詳細は [フェーズD 管理機能移行計画](admin_phase_d_transition_plan.md) を参照）。
- [ ] 各機能ごとに MFC 版との整合性を検証するリグレッションテストを用意する（計画は [フェーズD 管理機能移行計画](admin_phase_d_transition_plan.md) 第5章に集約）。
- [ ] 運用上のフェイルバック手順（Web UI 障害時に MFC を使う方法）を定義する（[フェーズD 管理機能移行計画](admin_phase_d_transition_plan.md) 第6章/第8章で手順策定）。
- [ ] ユーザー教育資料・操作マニュアルを更新する（成果物は [フェーズD 管理機能移行計画](admin_phase_d_transition_plan.md) のドキュメント項を参照）。

### フェーズ E: 移行完了と保守
- [ ] 主要機能の Web 化が完了したら、MFC 側の不要コードを段階的に削除する。
- [ ] 監視・アラートの整備（HTTP サーバー稼働監視、API エラー率など）。
- [ ] セキュリティレビューとペネトレーションテストを実施する。
- [ ] 保守チームへの引き継ぎ資料、オンボーディング手順を整備する。

## 4. タスク分割と引き継ぎルール
- 各フェーズ内でタスクを Issue/Ticket 化し、以下の情報を必ず付与する。
  - 目的・背景
  - 対象コード・モジュール
  - テスト観点
  - 想定する完了条件 (Definition of Done)
  - 依存するタスク
- 作業結果は共通 Wiki または docs/ 配下に Markdown で記録し、Pull Request にリンクする。
- 進捗共有は週次でステータスレポートを作成（完了/進行中/未着手の一覧）。
- 引き継ぎ時には、最新の API 定義書・画面仕様・テストケースを更新し、レビュー担当者に通知する。

## 5. リスクと対策
- **スケジュール遅延**: 初期にスコープを明確化し、先行 PoC で技術的難易度を確認する。
- **セキュリティリスク**: 早期にセキュリティチームのレビューを受け、通信の HTTPS 化や認証の強化を行う。
- **性能問題**: ベンチマーク計画を立て、想定負荷での応答時間を測定する。
- **レガシー依存**: MFC 特有のロジックはサーバー側に移植する際にリファクタリングし、テストコードを追加する。

## 6. 次のアクション（短期）
1. 現行管理機能の棚卸しワークショップを実施し、一覧表を作成する。
2. PoC として SboSvr に HTTP エンドポイント `/health` を実装し、Web サーバー組み込みの可否を確認する。
3. 上記 PoC の結果を基に、正式なアーキテクチャ設計書とスケジュール案を作成する。

## 7. 成果物チェックリスト
- 管理機能棚卸し表（スプレッドシート or Markdown）
- アーキテクチャ設計書
- API 定義書（OpenAPI など）
- Web UI デザインモック & コンポーネントガイド
- テスト計画書 & 自動テストスクリプト
- 運用・保守手順書

以上の計画に沿って進めることで、複数タスク間での引き継ぎが容易になり、段階的な Web 移行が可能となります。
